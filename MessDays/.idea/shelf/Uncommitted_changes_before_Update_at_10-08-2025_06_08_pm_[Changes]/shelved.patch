Index: app/src/main/java/com/example/messdays/widget/MyWidget.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.messdays.widget;\r\n\r\n\r\nimport android.appwidget.AppWidgetManager;\r\nimport android.appwidget.AppWidgetProvider;\r\nimport android.content.Context;\r\nimport android.widget.RemoteViews;\r\nimport android.widget.TextView;\r\n\r\nimport com.example.messdays.MainActivity;\r\nimport com.example.messdays.R;\r\n\r\npublic class MyWidget extends AppWidgetProvider {\r\n    TextView lunchCountTextView, dinnerCountTextView,messExpensesTextView;\r\n    @Override\r\n    public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) {\r\n        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.widget_layout);\r\n        views.setTextViewText(R.id.widget_lunch_count, String.valueOf(MainActivity.counts.get(0)));\r\n        views.setTextViewText(R.id.widget_dinner_count, String.valueOf(MainActivity.counts.get(1)));\r\n        views.setTextViewText(R.id.widget_mess_expenses, String.valueOf(MainActivity.counts.get(2)));\r\n\r\n        for (int appWidgetId : appWidgetIds) {\r\n            appWidgetManager.updateAppWidget(appWidgetId, views);\r\n        }\r\n    }\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/messdays/widget/MyWidget.java b/app/src/main/java/com/example/messdays/widget/MyWidget.java
--- a/app/src/main/java/com/example/messdays/widget/MyWidget.java	(revision c37d3513091e09170183d2c3e195aa4db2f04559)
+++ b/app/src/main/java/com/example/messdays/widget/MyWidget.java	(date 1754829481070)
@@ -1,27 +1,206 @@
 package com.example.messdays.widget;
 
+import static com.example.messdays.MainActivity.MONTH_MAP_KEY;
+import static com.example.messdays.MainActivity.PREFS_NAME;
 
+import java.lang.reflect.Type;
+
+import android.app.PendingIntent;
 import android.appwidget.AppWidgetManager;
 import android.appwidget.AppWidgetProvider;
+import android.content.ComponentName;
 import android.content.Context;
+import android.content.Intent;
+import android.content.SharedPreferences;
+import android.util.Log;
 import android.widget.RemoteViews;
-import android.widget.TextView;
 
+import com.example.messdays.LocalDateAdapter;
 import com.example.messdays.MainActivity;
 import com.example.messdays.R;
+import com.example.messdays.data.MessDayEvent;
+import com.google.gson.Gson;
+import com.google.gson.GsonBuilder;
+import com.google.gson.reflect.TypeToken;
+
+import java.time.LocalDate;
+import java.time.format.DateTimeFormatter;
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
 
 public class MyWidget extends AppWidgetProvider {
-    TextView lunchCountTextView, dinnerCountTextView,messExpensesTextView;
+
+    public static final String ACTION_LUNCH_CLICK = "com.example.messdays.ACTION_LUNCH_CLICK";
+    public static final String ACTION_DINNER_CLICK = "com.example.messdays.ACTION_DINNER_CLICK";
+    public static final String ACTION_DATE_CHANGED = "android.intent.action.DATE_CHANGED";
+
+    private static List<Integer> counts = new ArrayList<>();
+    public static void updateWidget(Context context) {
+
+        AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(context);
+        ComponentName widgetComponent = new ComponentName(context, MyWidget.class);
+        int[] appWidgetIds = appWidgetManager.getAppWidgetIds(widgetComponent);
+
+        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.widget_layout);
+
+        // Set up the intent that starts the MainActivity
+        Intent intent = new Intent(context, MainActivity.class);
+        PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent, PendingIntent.FLAG_IMMUTABLE);
+        views.setOnClickPendingIntent(R.id.widget_root, pendingIntent);
+
+
+
+        MessDayEvent messDayEvent = getCurrentMessEvent(context).get(LocalDate.now());
+
+
+        counts = getCounts(context);
+
+        Log.d("MyWidget", "Updating widget " +counts);
+
+        // Initialize text views
+        views.setTextViewText(R.id.widget_date_header, LocalDate.now().toString());
+        views.setTextViewText(R.id.widget_lunch_count  , Integer.toString(counts.get(0)));
+        views.setTextViewText(R.id.widget_dinner_count, Integer.toString(counts.get(1)));
+        views.setTextViewText(R.id.widget_mess_expenses, " â‚¹" +counts.get(2));
+
+        views.setImageViewResource(R.id.lunchCheckBox, messDayEvent != null && messDayEvent.isHasLunch() ? R.drawable.meal : R.drawable.meal_gray);
+        views.setImageViewResource(R.id.dinnerCheckBox, messDayEvent != null && messDayEvent.isHasDinner() ? R.drawable.meal : R.drawable.meal_gray);
+
+        Intent lunchClickIntent = new Intent(context, MyWidget.class);
+        lunchClickIntent.setAction(ACTION_LUNCH_CLICK);
+        views.setOnClickPendingIntent(R.id.lunchCheckBox, PendingIntent.getBroadcast(context, 0, lunchClickIntent, PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE));
+
+        Intent dinnerClickIntent = new Intent(context, MyWidget.class);
+        dinnerClickIntent.setAction(ACTION_DINNER_CLICK);
+        views.setOnClickPendingIntent(R.id.dinnerCheckBox, PendingIntent.getBroadcast(context, 0, dinnerClickIntent, PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE));
+
+
+        appWidgetManager.updateAppWidget(widgetComponent, views);
+
+    }
+
     @Override
     public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) {
-        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.widget_layout);
-        views.setTextViewText(R.id.widget_lunch_count, String.valueOf(MainActivity.counts.get(0)));
-        views.setTextViewText(R.id.widget_dinner_count, String.valueOf(MainActivity.counts.get(1)));
-        views.setTextViewText(R.id.widget_mess_expenses, String.valueOf(MainActivity.counts.get(2)));
+        updateWidget(context);
+    }
+
+    @Override
+    public void onReceive(Context context, Intent intent) {
+        super.onReceive(context, intent);
+
+        String action = intent.getAction();
+        if (action != null) {
+            Map<LocalDate, MessDayEvent> currentMonthEvents = getCurrentMessEvent(context);
+            MessDayEvent todayEvent = currentMonthEvents.get(LocalDate.now());
+
+            if (todayEvent == null) {
+                todayEvent = new MessDayEvent(LocalDate.now(), false, false,"");
+                currentMonthEvents.put(LocalDate.now(), todayEvent);
+            }
+
+            boolean needsUpdate = false;
+
+            if (ACTION_LUNCH_CLICK.equals(action)) {
+                Log.d("MyWidget", "Lunch checkbox clicked");
+                todayEvent.setHasLunch(!todayEvent.isHasLunch());
+                // Update background directly for immediate feedback
+                RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.widget_layout);
+                views.setImageViewResource(R.id.lunchCheckBox, todayEvent.isHasLunch() ? R.drawable.meal : R.drawable.meal_gray);
+                AppWidgetManager.getInstance(context).updateAppWidget(new ComponentName(context, MyWidget.class), views);
+                needsUpdate = true;
+            } else if (ACTION_DINNER_CLICK.equals(action)) {
+                Log.d("MyWidget", "Dinner checkbox clicked");
+                todayEvent.setHasDinner(!todayEvent.isHasDinner());
+                needsUpdate = true;
+            } else if (ACTION_DATE_CHANGED.equals(action) || Intent.ACTION_TIME_CHANGED.equals(action) || Intent.ACTION_TIMEZONE_CHANGED.equals(action)) {
+                Log.d("MyWidget", "Date or time changed, updating widget");
+                // When the date changes, we need to refresh the widget with the new day's data.
+                // updateWidget() will fetch the new day's event and counts.
+                needsUpdate = true;
+            }
+
+            // Update background directly for immediate feedback if dinner is clicked
+            RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.widget_layout);
+            views.setImageViewResource(R.id.dinnerCheckBox, todayEvent.isHasDinner() ? R.drawable.meal : R.drawable.meal_gray);
+            AppWidgetManager.getInstance(context).updateAppWidget(new ComponentName(context, MyWidget.class), views);
+            if (needsUpdate) {
+                // Save the updated map
+                Map<String, Map<LocalDate, MessDayEvent>> monthMap = getMonthMap(context);
+                monthMap.put(monthYearFromDate(LocalDate.now()), currentMonthEvents);
+                saveMonthMap(context, monthMap);
+
+                // Update the widget UI
+                updateWidget(context);
+            }
+        }
+    }
+
+    private static void saveMonthMap(Context context, Map<String, Map<LocalDate, MessDayEvent>> monthMap) {
+        SharedPreferences prefs = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);
+        SharedPreferences.Editor editor = prefs.edit();
+        Gson gson = new GsonBuilder()
+                .registerTypeAdapter(LocalDate.class, new LocalDateAdapter())
+                .create();
+        String json = gson.toJson(monthMap);
+        editor.putString(MONTH_MAP_KEY, json);
+        editor.apply();
+    }
+
+    private static String monthYearFromDate(LocalDate date) {
+        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("MMMM yyyy");
+        return date.format(formatter);
+    }
+
+    public static Map<String,Map<LocalDate, MessDayEvent>> getMonthMap(Context context) {
+        SharedPreferences prefs = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);
+        Gson gson = new GsonBuilder()
+                .registerTypeAdapter(LocalDate.class, new LocalDateAdapter())
+                .create();
+        String json = prefs.getString(MONTH_MAP_KEY, null);
+
+        Type type = new TypeToken<HashMap<String, HashMap<LocalDate, MessDayEvent>>>(){}.getType();
+        Map<String, Map<LocalDate, MessDayEvent>> monthMap = gson.fromJson(json, type);
+        return monthMap != null ? monthMap : new HashMap<>(); // Return empty map if null
+    }
+
+    public static Map<LocalDate, MessDayEvent> getCurrentMessEvent(Context context){
+        Map<String, Map<LocalDate, MessDayEvent>> monthMap = getMonthMap(context);
+        String currentMonthKey = monthYearFromDate(LocalDate.now());
+        // Ensure the current month exists in the map
+        return monthMap.computeIfAbsent(currentMonthKey, k -> new HashMap<>());
+    }
+
+    public static List<Integer> getCounts(Context context) {
+        List<Integer> counts = new ArrayList<>();
+        Map<LocalDate, MessDayEvent> currentMonthEvents = getCurrentMessEvent(context);
+        long totalLunchCount = 0;
+        long totalDinnerCount = 0;
+
+
+        if (currentMonthEvents != null) {
+            for (MessDayEvent event : currentMonthEvents.values()) {
 
-        for (int appWidgetId : appWidgetIds) {
-            appWidgetManager.updateAppWidget(appWidgetId, views);
-        }
-    }
-}
+                if (event.isHasLunch()) {
+                    totalLunchCount++;
+                }
+                if (event.isHasDinner()) {
+                    totalDinnerCount++;
+                }
+            }
+        }
+        long lunchAmount = totalLunchCount * 60;
+        long dinnerAmount = totalDinnerCount * 60;
+        long messExpenses = lunchAmount + dinnerAmount;
+        counts.clear();
+        counts.add((int) totalLunchCount);
+        counts.add((int) totalDinnerCount);
+        counts.add((int) messExpenses);
+
+        return counts;
+    }
 
+
+
+}
Index: app/src/main/res/layout/widget_layout.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout\r\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:id=\"@+id/widget_root\"\r\n    android:layout_width=\"170dp\"\r\n    android:layout_height=\"180dp\"\r\n    android:orientation=\"vertical\"\r\n    android:padding=\"12dp\">\r\n\r\n    <!-- Lunch Times Total -->\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:orientation=\"horizontal\"\r\n        android:gravity=\"center_vertical\"\r\n        android:paddingTop=\"8dp\"\r\n        android:paddingBottom=\"8dp\">\r\n\r\n        <ImageView\r\n            android:layout_width=\"32dp\"\r\n            android:layout_height=\"32dp\"\r\n            android:src=\"@drawable/lunch_time\"\r\n            android:contentDescription=\"Lunch Icon\" />\r\n\r\n        <TextView\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginStart=\"8dp\"\r\n            android:text=\"Lunch:\"\r\n            android:textSize=\"14sp\"\r\n            android:textColor=\"#000000\" />\r\n\r\n        <TextView\r\n            android:id=\"@+id/widget_lunch_count\"\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginStart=\"4dp\"\r\n            android:text=\"0\"\r\n            android:textStyle=\"bold\"\r\n            android:textSize=\"14sp\"\r\n            android:textColor=\"#000000\" />\r\n    </LinearLayout>\r\n\r\n    <!-- Dinner Times Total -->\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:orientation=\"horizontal\"\r\n        android:gravity=\"center_vertical\"\r\n        android:paddingTop=\"8dp\"\r\n        android:paddingBottom=\"8dp\">\r\n\r\n        <ImageView\r\n            android:layout_width=\"32dp\"\r\n            android:layout_height=\"32dp\"\r\n            android:src=\"@drawable/dinner\"\r\n            android:contentDescription=\"Dinner Icon\" />\r\n\r\n        <TextView\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginStart=\"8dp\"\r\n            android:text=\"Dinner:\"\r\n            android:textSize=\"14sp\"\r\n            android:textColor=\"#000000\" />\r\n\r\n        <TextView\r\n            android:id=\"@+id/widget_dinner_count\"\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginStart=\"4dp\"\r\n            android:text=\"0\"\r\n            android:textStyle=\"bold\"\r\n            android:textSize=\"14sp\"\r\n            android:textColor=\"#000000\" />\r\n    </LinearLayout>\r\n\r\n    <!-- Mess Expenses -->\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:orientation=\"horizontal\"\r\n        android:gravity=\"center_vertical\"\r\n        android:paddingTop=\"8dp\"\r\n        android:paddingBottom=\"8dp\">\r\n\r\n        <ImageView\r\n            android:layout_width=\"32dp\"\r\n            android:layout_height=\"32dp\"\r\n            android:src=\"@drawable/total\"\r\n            android:contentDescription=\"Total Icon\" />\r\n\r\n        <TextView\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginStart=\"8dp\"\r\n            android:text=\"Total:\"\r\n            android:textSize=\"14sp\"\r\n            android:textColor=\"#000000\" />\r\n\r\n        <TextView\r\n            android:id=\"@+id/widget_mess_expenses\"\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginStart=\"4dp\"\r\n            android:text=\"â‚¹0\"\r\n            android:textStyle=\"bold\"\r\n            android:textSize=\"14sp\"\r\n            android:textColor=\"#000000\" />\r\n    </LinearLayout>\r\n\r\n</LinearLayout>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/layout/widget_layout.xml b/app/src/main/res/layout/widget_layout.xml
--- a/app/src/main/res/layout/widget_layout.xml	(revision c37d3513091e09170183d2c3e195aa4db2f04559)
+++ b/app/src/main/res/layout/widget_layout.xml	(date 1754829466114)
@@ -2,19 +2,22 @@
 <LinearLayout
     xmlns:android="http://schemas.android.com/apk/res/android"
     android:id="@+id/widget_root"
-    android:layout_width="170dp"
-    android:layout_height="180dp"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent"
+    android:layout_gravity="center"
     android:orientation="vertical"
-    android:padding="12dp">
+    android:padding="10dp"
+    android:background="#78FFFFFF">
+
 
-    <!-- Lunch Times Total -->
+
+    <!-- Lunch Count -->
     <LinearLayout
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
         android:orientation="horizontal"
-        android:gravity="center_vertical"
-        android:paddingTop="8dp"
-        android:paddingBottom="8dp">
+        android:gravity="center"
+        android:paddingVertical="2dp">
 
         <ImageView
             android:layout_width="32dp"
@@ -36,19 +39,18 @@
             android:layout_height="wrap_content"
             android:layout_marginStart="4dp"
             android:text="0"
-            android:textStyle="bold"
+            android:textColor="#000000"
             android:textSize="14sp"
-            android:textColor="#000000" />
+            android:textStyle="bold" />
     </LinearLayout>
 
-    <!-- Dinner Times Total -->
+    <!-- Dinner Count -->
     <LinearLayout
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
         android:orientation="horizontal"
-        android:gravity="center_vertical"
-        android:paddingTop="8dp"
-        android:paddingBottom="8dp">
+        android:gravity="center"
+        android:paddingVertical="2dp">
 
         <ImageView
             android:layout_width="32dp"
@@ -80,9 +82,8 @@
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
         android:orientation="horizontal"
-        android:gravity="center_vertical"
-        android:paddingTop="8dp"
-        android:paddingBottom="8dp">
+        android:gravity="center"
+        android:paddingVertical="2dp">
 
         <ImageView
             android:layout_width="32dp"
@@ -108,5 +109,66 @@
             android:textSize="14sp"
             android:textColor="#000000" />
     </LinearLayout>
+    <!-- Date Header -->
+    <TextView
+        android:id="@+id/widget_date_header"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:gravity="center_horizontal"
+        android:text="Date : "
+        android:textSize="16sp"
+        android:layout_marginTop="12dp"
+        android:textColor="#000000"
+        android:textStyle="bold" />
+
+    <!-- Checkboxes for Lunch and Dinner -->
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:orientation="horizontal"
+        android:layout_gravity="center"
+        android:layout_marginTop="6dp"
+        android:gravity="center">
+
+        <LinearLayout
+            android:layout_width="wrap_content"
+            android:layout_height="match_parent"
+            android:orientation="vertical"
+            android:gravity="center">
+            <ImageView
+                android:layout_width="36dp"
+                android:layout_height="36dp"
+                android:id="@+id/lunchCheckBox"
+                android:src="@drawable/meal_gray"
+                android:backgroundTint="@color/cardview_dark_background" />
+            <TextView
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:text="Lunch"
+                android:textColor="@color/black"/>
+
+        </LinearLayout>
+
+        <LinearLayout
+            android:layout_width="wrap_content"
+            android:layout_height="match_parent"
+            android:layout_marginStart="30dp"
+            android:orientation="vertical"
+            android:gravity="center">
+            <ImageView
+                android:layout_width="36dp"
+                android:layout_height="36dp"
+                android:id="@+id/dinnerCheckBox"
+                android:src="@drawable/meal_gray"
+                android:backgroundTint="@color/cardview_dark_background" />
+            <TextView
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:text="Dinner"
+                android:textColor="@color/black"/>
+
+        </LinearLayout>
+    </LinearLayout>
+
 
 </LinearLayout>
Index: app/src/main/res/xml/my_widget_info.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<appwidget-provider xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:minWidth=\"130dp\"\r\n    android:minHeight=\"80dp\"\r\n    android:maxResizeHeight=\"150dp\"\r\n    android:maxResizeWidth=\"180dp\"\r\n    android:updatePeriodMillis=\"1800000\"\r\n    android:initialLayout=\"@layout/widget_layout\"\r\n    android:resizeMode=\"horizontal|vertical\"\r\n    android:widgetCategory=\"home_screen\" />
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/xml/my_widget_info.xml b/app/src/main/res/xml/my_widget_info.xml
--- a/app/src/main/res/xml/my_widget_info.xml	(revision c37d3513091e09170183d2c3e195aa4db2f04559)
+++ b/app/src/main/res/xml/my_widget_info.xml	(date 1754829466120)
@@ -1,9 +1,7 @@
 <?xml version="1.0" encoding="utf-8"?>
 <appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"
     android:minWidth="130dp"
-    android:minHeight="80dp"
-    android:maxResizeHeight="150dp"
-    android:maxResizeWidth="180dp"
+    android:minHeight="50dp"
     android:updatePeriodMillis="1800000"
     android:initialLayout="@layout/widget_layout"
     android:resizeMode="horizontal|vertical"
